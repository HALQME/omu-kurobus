---
export const prerender = false;
import Layout from "@/src/layouts/layout.astro";
import { styles } from "@/styles/style";
import CourseInfo from "@/src/components/course-info.astro";

const { year, semester, id } = Astro.params;
if (!id || !year || !semester) {
    return Astro.redirect("/404");
}
---

<Layout title="感想投稿" description="授業の感想を共有しよう">
    <section class={styles.section.container}>
        <div class={styles.section.headingWrapper}>
            <div
                class={`${styles.section.headingLine} ${styles.section.headingLineLeft}`}
            >
            </div>
            <h2 class={styles.section.title}>感想を投稿</h2>
            <div
                class={`${styles.section.headingLine} ${styles.section.headingLineRight}`}
            >
            </div>
        </div>
        <div class={styles.section.content}>
            <CourseInfo id={id} />
            <form action="/api/submit" method="post">
                <input type="hidden" name="course_id" value={id} />
                <div class="mb-4">
                    <label for="studentNumber" class={styles.form.label}>
                        学籍番号<span class="text-red-500">*</span>
                    </label>
                    <input
                        type="text"
                        id="studentNumber"
                        name="studentNumber"
                        class={styles.form.input}
                        pattern="[A-Z]{3}[0-9]{5}"
                        required
                    />
                    <small>
                        この情報は送信されません。学部・学科の情報のみ送信されます。
                    </small>
                </div>
                <section class="mb-4" aria-labelledby="evaluation-style">
                    <div class="mb-4">
                        <section class="mb-4" aria-labelledby="scoring">
                            <h3
                                id="scoring"
                                class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-200"
                            >
                                スコア評価
                            </h3>
                            <div
                                class="space-y-6 bg-white/50 dark:bg-gray-800/50 rounded-lg p-6 shadow-sm"
                            >
                                <div
                                    class="p-4 bg-white dark:bg-gray-800 rounded-md border border-gray-100 dark:border-gray-700"
                                >
                                    <label class={styles.form.label}>
                                        授業の難易度<span class="text-red-500"
                                            >*</span
                                        >
                                    </label>
                                    <div class={styles.form.slider.container}>
                                        <div class={styles.form.slider.wrapper}>
                                            <input
                                                type="range"
                                                name="classDifficulty"
                                                min="1"
                                                max="4"
                                                value="2"
                                                required
                                                class={styles.form.slider.input}
                                            />
                                        </div>
                                        <div class={styles.form.slider.labels}>
                                            <span>難しい</span>
                                            <span>簡単</span>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="p-4 bg-white dark:bg-gray-800 rounded-md border border-gray-100 dark:border-gray-700"
                                >
                                    <label class={styles.form.label}>
                                        テスト/レポートの難易度<span
                                            class="text-red-500">*</span
                                        >
                                    </label>
                                    <div class={styles.form.slider.container}>
                                        <div class={styles.form.slider.wrapper}>
                                            <input
                                                type="range"
                                                name="testDifficulty"
                                                min="1"
                                                max="4"
                                                value="2"
                                                required
                                                class={styles.form.slider.input}
                                            />
                                        </div>
                                        <div class={styles.form.slider.labels}>
                                            <span>難しい</span>
                                            <span>簡単</span>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="p-4 bg-white dark:bg-gray-800 rounded-md border border-gray-100 dark:border-gray-700"
                                >
                                    <label class={styles.form.label}>
                                        テスト/レポートの量<span
                                            class="text-red-500">*</span
                                        >
                                    </label>
                                    <div class={styles.form.slider.container}>
                                        <div class={styles.form.slider.wrapper}>
                                            <input
                                                type="range"
                                                name="testAmount"
                                                min="1"
                                                max="4"
                                                value="2"
                                                required
                                                class={styles.form.slider.input}
                                            />
                                        </div>
                                        <div class={styles.form.slider.labels}>
                                            <span>多い</span>
                                            <span>少ない</span>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="p-4 bg-white dark:bg-gray-800 rounded-md border border-gray-100 dark:border-gray-700"
                                >
                                    <label class={styles.form.label}>
                                        成績の評定基準<span class="text-red-500"
                                            >*</span
                                        >
                                    </label>
                                    <div class={styles.form.slider.container}>
                                        <div class={styles.form.slider.wrapper}>
                                            <input
                                                type="range"
                                                name="gradingCriteria"
                                                min="1"
                                                max="4"
                                                value="2"
                                                required
                                                class={styles.form.slider.input}
                                            />
                                        </div>
                                        <div class={styles.form.slider.labels}>
                                            <span>厳しい</span>
                                            <span>緩い</span>
                                        </div>
                                    </div>
                                </div>
                                <div
                                    class="p-4 bg-white dark:bg-gray-800 rounded-md border border-gray-100 dark:border-gray-700"
                                >
                                    <label class={styles.form.label}>
                                        お勧め度<span class="text-red-500"
                                            >*</span
                                        >
                                    </label>
                                    <div class={styles.form.slider.container}>
                                        <div class={styles.form.slider.wrapper}>
                                            <input
                                                type="range"
                                                name="recommendation"
                                                min="1"
                                                max="4"
                                                value="2"
                                                required
                                                class={styles.form.slider.input}
                                            />
                                        </div>
                                        <div class={styles.form.slider.labels}>
                                            <span>お勧めしない</span>
                                            <span>お勧め</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                        <section class="mb-4" aria-labelledby="comments">
                            <div class="mb-4">
                                <label for="goodPoint" class={styles.form.label}
                                    >授業の良かったところ</label
                                >
                                <textarea
                                    id="goodPoint"
                                    name="goodPoint"
                                    rows="3"
                                    class={styles.form.textarea}></textarea>
                            </div>
                            <div class="mb-4">
                                <label
                                    for="notGoodPoint"
                                    class={styles.form.label}
                                    >授業の良くなかったところ</label
                                >
                                <textarea
                                    id="notGoodPoint"
                                    name="notGoodPoint"
                                    rows="3"
                                    class={styles.form.textarea}></textarea>
                            </div>
                            <div class="mb-4">
                                <label for="comment" class={styles.form.label}
                                    >その他</label
                                >
                                <textarea
                                    id="comment"
                                    name="comment"
                                    rows="3"
                                    class={styles.form.textarea}></textarea>
                            </div>
                        </section>
                    </div>
                </section>
                <div class="flex justify-center mt-6">
                    <button type="submit" class={styles.button.primary}>
                        投稿する
                    </button>
                </div>
            </form>
        </div>
    </section>
</Layout>

<script>
    // スライダーの値を表示に反映させる
    document.querySelectorAll('input[type="range"]').forEach((slider) => {
        if (!(slider instanceof HTMLInputElement)) return;

        const valueDisplay = slider.nextElementSibling;
        if (!valueDisplay) return;

        // 初期値を設定
        valueDisplay.textContent = slider.value;

        // 値が変更されたときの処理
        slider.addEventListener("input", () => {
            valueDisplay.textContent = slider.value;
        });
    });
</script>
