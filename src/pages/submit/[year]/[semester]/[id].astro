---
import Layout from "@/src/layouts/layout.astro";
import { styles } from "@/styles/style";
import type { Course } from "@/types/schema";
import * as store from "@/utils/store";

const { year, semester, id } = Astro.params;
if (!id || !year || !semester) {
    return Astro.redirect("/404");
}

let course: Course | null = store.getCourse(id);

if (!course) {
    const courseUrl = new URL(
        `https://raw.githubusercontent.com/HALQME/omu-course-library/refs/heads/main/data/${year}/${semester}/data.json`
    );

    const courseData: Course[] = await fetch(courseUrl).then((res) =>
        res.json()
    );
    course = courseData.find((c: Course) => c.id === id) ?? null;
    if (!course) {
        return Astro.redirect("/404");
    }
}
---

<Layout title="感想投稿" description="授業の感想を共有しよう">
    <section class={styles.section.container}>
        <div class={styles.section.headingWrapper}>
            <div
                class={`${styles.section.headingLine} ${styles.section.headingLineLeft}`}
            >
            </div>
            <h2 class={styles.section.title}>感想を投稿</h2>
            <div
                class={`${styles.section.headingLine} ${styles.section.headingLineRight}`}
            >
            </div>
        </div>
        <div class={styles.section.content}>
            <p class="text-gray-500 dark:text-gray-400 mb-0">
                {course.campus} - {course.semester} / {course.period}
            </p>
            <h3 class="text-lg mb-0.5">{course.name}</h3>
            <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">
                {course.teachers}
            </p>
            <form action="/api/submit" method="post">
                <div class="mb-4">
                    <label for="name" class={styles.form.label}>名前</label>
                    <input
                        type="text"
                        id="name"
                        name="name"
                        class={styles.form.input}
                    />
                </div>
                <div class="mb-4">
                    <label for="content" class={styles.form.label}>感想</label>
                    <textarea
                        id="content"
                        name="content"
                        rows="3"
                        class={styles.form.textarea}></textarea>
                </div>
            </form>
        </div>
    </section>
</Layout>
