---
import TimeTable from "../components/timetable";
import Layout from "../layouts/layout.astro";
import { PATH_PAIRS, CURRENT_PAIR } from "@/utils/const";

// åˆ©ç”¨å¯èƒ½ãªå¹´åº¦ãƒ»å­¦æœŸã®ãƒšã‚¢ã‚’å–å¾—
const pairs = PATH_PAIRS();
// é‡è¤‡ãªã—ã®å¹´åº¦ãƒªã‚¹ãƒˆã‚’ä½œæˆï¼ˆæ–°ã—ã„é †ï¼‰
const years = [...new Set(pairs.map((pair) => pair.path.year))]
    .sort()
    .reverse();

// ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ç¾åœ¨ã®å¹´åº¦ã‚’é¸æŠ
const currentPair = CURRENT_PAIR();
const defaultYear = years.includes(currentPair.year)
    ? currentPair.year
    : years[0];
---

<Layout title="æ™‚é–“å‰²è¡¨">
    <div class="max-w-5xl mx-auto px-4">
        <h1
            class="text-2xl md:text-3xl font-bold text-center mb-6 bg-gradient-to-r from-pink-500 to-violet-500 bg-clip-text text-transparent"
        >
            æ™‚é–“å‰²è¡¨
        </h1>

        <div class="mb-6">
            <label
                for="yearSelect"
                class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"
            >
                å¹´åº¦ã‚’é¸æŠ:
            </label>
            <select
                id="yearSelect"
                class="w-full md:w-auto bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-pink-500"
            >
                {
                    years.map((year) => (
                        <option value={year} selected={year === defaultYear}>
                            {year}å¹´åº¦
                        </option>
                    ))
                }
            </select>
        </div>

        {
            years.map((year) => (
                <div
                    id={`year-${year}`}
                    class={year === defaultYear ? "" : "hidden"}
                >
                    <div class="mb-10">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-2 text-pink-500 dark:text-pink-400">
                                ğŸ“…
                            </span>
                            {year}å¹´åº¦ å‰æœŸ
                        </h2>
                        <TimeTable
                            client:only="react"
                            semester="0"
                            year={year}
                        />
                    </div>

                    <div class="mb-10">
                        <h2 class="text-xl font-bold mb-4 flex items-center">
                            <span class="mr-2 text-violet-500 dark:text-violet-400">
                                ğŸ
                            </span>
                            {year}å¹´åº¦ å¾ŒæœŸ
                        </h2>
                        <TimeTable
                            client:only="react"
                            semester="1"
                            year={year}
                        />
                    </div>
                </div>
            ))
        }
    </div>
</Layout>

<script>
    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§å¹´åº¦é¸æŠã®å¤‰æ›´ã‚’å‡¦ç†
    const yearSelect = document.getElementById(
        "yearSelect"
    ) as HTMLSelectElement;
    yearSelect?.addEventListener("change", () => {
        // ã™ã¹ã¦ã®å¹´åº¦ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’éè¡¨ç¤º
        document.querySelectorAll('[id^="year-"]').forEach((el) => {
            el.classList.add("hidden");
        });

        // é¸æŠã•ã‚ŒãŸå¹´åº¦ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’è¡¨ç¤º
        const selectedYear = yearSelect.value;
        const selectedContainer = document.getElementById(
            `year-${selectedYear}`
        );
        if (selectedContainer) {
            selectedContainer.classList.remove("hidden");
        }
    });
</script>
